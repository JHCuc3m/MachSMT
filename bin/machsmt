#!/usr/bin/env python3

import argparse,os,sys,glob,pickle
import numpy as np
from machsmt.util import die
from machsmt.benchmark import Benchmark
import machsmt.settings as settings

if __name__ == "__main__":
    if len(sys.argv) <= 1: die("Please provide a file to make a prediction on.")
    for file in sys.argv[1:]:
        if not os.path.exists(file): die("Could not find: " + str(file))
        b = Benchmark(file)
        b.parse()
        b.compute_features()

        logic,track = b.logic,b.track
        models = glob.glob(settings.LIB_DIR + '/tracks/' + logic + '/' + track + '/*.p')
        predictions = []
        for model in models:
            predictions.append(pickle.load(open(model, "rb")).predict(np.array(b.get_features()).reshape(1, -1)))
        print(models[np.argmin(predictions)].split('/')[-1].replace('.p',''))