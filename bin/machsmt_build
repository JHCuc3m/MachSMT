#!/usr/bin/env python3

import argparse,os,pickle,sys,pdb

import machsmt.settings as settings

from machsmt.db import DB
from machsmt.model_builder import ModelBuilder
from machsmt.util import die

if __name__ == '__main__':

    ## Setup parser
    parser = argparse.ArgumentParser()
    parser.add_argument("-f", "--data-files",
                    metavar="files[,files...]",
                    action="store",
                    dest="files",
                    default=None,
                    nargs='+',
                    help="Input Data files containing solver, benchmark, runtime pairs"
    )

    parser.add_argument("-l", "--lib-directory",
                metavar="lib",
                action="store",
                dest="lib",
                default=None,
                type=str,
                help="Input Data files containing solver, benchmark, runtime pairs"
    )

    args = parser.parse_args()

    if args.lib != None: settings.LIB_DIR = args.lib

    db = DB()

    try:
        db.load()
    except FileNotFoundError:
        print("No database found.")
        if args.files == None: die("No input files to build database from!")
    
    ## Build DB on new Data
    if args.files != None: db.build(args.files)

    ## Build models
    ModelBuilder(db).build()

    ##END OF SCRIPT
    print("Successfully Built MachSMT!")
