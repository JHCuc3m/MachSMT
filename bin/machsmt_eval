#!/usr/bin/env python3

import argparse,os,pickle,sys,pdb,traceback

import machsmt.settings as settings

from machsmt.db import DB
from machsmt.model_evaluator import ModelEvaluator
from machsmt.util import die

if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument("-l", "--lib-directory",
            metavar="lib",
            action="store",
            dest="lib",
            default=None,
            type=str,
            help="Input Data files containing solver, benchmark, runtime pairs")
    args = parser.parse_args()

    db = DB()
    try:
        if args.lib != None: settings.LIB_DIR = args.lib
        db.load()
    except FileNotFoundError:
        die("No database found.")
    try:
        ModelEvaluator(db).run()
    except:
        extype, value, tb = sys.exc_info()
        traceback.print_exc()
        pdb.post_mortem(tb)

    print("Successfully Evaluated MachSMT!")